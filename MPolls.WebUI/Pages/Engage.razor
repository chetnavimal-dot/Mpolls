@page "/engage/profile"
@layout SurveyLayout

<PageTitle>Engage</PageTitle>

<MudContainer MaxWidth="MaxWidth.Large" Class="py-6">
    <MudStack Spacing="4">
        @if (IsLoading)
        {
            <div class="d-flex justify-center my-10">
                <MudProgressCircular Color="Color.Primary" Indeterminate="true" Size="Size.Large" />
            </div>
        }
        else if (!string.IsNullOrWhiteSpace(LoadErrorMessage))
        {
            <MudAlert Severity="Severity.Error">@LoadErrorMessage</MudAlert>
        }
        else if (ShowCompletionSummary)
        {
            <MudStack Spacing="4">
                <MudPaper Class="pa-6" Elevation="2">
                    <MudStack Spacing="2">
                        <MudStack Direction="Row" AlignItems="AlignItems.Center" Spacing="1" Class="flex-wrap">
                            <MudIcon Icon="@Icons.Material.Filled.CheckCircle" Color="Color.Success" />
                            <MudText Typo="Typo.h4">@CompletionTitle</MudText>
                        </MudStack>
                        <MudText Typo="Typo.subtitle1">@CompletionMessage</MudText>

                        @if (ShowCompletionRewardSummary)
                        {
                            <MudDivider />
                            <MudStack Spacing="1">
                                <MudText Typo="Typo.h4" Class="font-weight-bold">@CompletionRewardPointsText</MudText>
                                <MudText Typo="Typo.subtitle2">@CompletionRewardLabel</MudText>
                                <MudText Typo="Typo.body2">@CompletionRewardDescription</MudText>
                            </MudStack>
                        }

                        <MudStack Direction="Row" Spacing="2" Class="mt-4 flex-wrap">
                            <MudButton Variant="Variant.Filled"
                                       Color="Color.Primary"
                                       OnClick="NavigateToCategoryDetails">
                                Back to Profile Details
                            </MudButton>
                        </MudStack>
                    </MudStack>
                </MudPaper>

                <MudPaper Class="pa-6" Elevation="2">
                    <MudStack Spacing="2">
                        <MudText Typo="Typo.h5">Survey Responses (JSON)</MudText>

                        @if (HasResponses)
                        {
                            <pre class="survey-results-json">@FormattedResponsesJson</pre>
                        }
                        else
                        {
                            <MudText Typo="Typo.subtitle2">No survey responses were captured.</MudText>
                        }
                    </MudStack>
                </MudPaper>
            </MudStack>
        }
        else if (ShowForm)
        {
            @if (!ShouldShowSurveyContainer)
            {
                <MudPaper Class="pa-6">
                    <MudStack Spacing="4">
                        <MudStack Spacing="1">
                            <MudText Typo="Typo.h4">@SurveyIntroTitle</MudText>
                            <MudText Typo="Typo.body2">@SurveyOverviewText</MudText>
                        </MudStack>

                        @if (CanShowRewardSummary)
                        {
                            <MudGrid Spacing="3">
                                <MudItem xs="12" md="4">
                                    <MudCard Class="pa-4 d-flex flex-row gap-3" Style="height: 100%">
                                        <MudIcon Icon="@Icons.Material.Filled.EmojiEvents" Color="Color.Primary" Size="Size.Large" />
                                        <MudStack Spacing="1">
                                            <MudText Typo="Typo.h4" Class="font-weight-bold">@ExpectedRewardPointsText</MudText>
                                            <MudText Typo="Typo.subtitle2">@ExpectedRewardPointsLabel</MudText>
                                        </MudStack>
                                    </MudCard>
                                </MudItem>
                                <MudItem xs="12" md="8">
                                    <MudCard Class="pa-4" Style="height: 100%">
                                        <MudStack Spacing="1">
                                            <MudText Typo="Typo.subtitle1">Reward Details</MudText>
                                            <MudText Typo="Typo.body2">@RewardSummaryText</MudText>
                                        </MudStack>
                                    </MudCard>
                                </MudItem>
                            </MudGrid>
                        }

                        <MudDivider />

                        <MudStack Spacing="3">
                            <MudText Typo="Typo.subtitle1">Before you begin</MudText>
                            <MudList Class="d-flex flex-column gap-4" T="string" Dense="true">
                                <MudContainer Class="d-flex align-center px-0 gap-2">
                                    <MudIcon Icon="@Icons.Material.Filled.CheckCircle" Color="Color.Primary" />
                                    <MudText Typo="Typo.body2">Answer every question honestly to keep your profile and opportunities accurate.</MudText>
                                </MudContainer>
                                <MudContainer Class="d-flex align-center px-0 gap-2">
                                    <MudIcon Icon="@Icons.Material.Filled.Timer" Color="Color.Primary" />
                                    <MudText Typo="Typo.body2">Some sections may be timed. Stay focused so you can finish within the allotted time.</MudText>
                                </MudContainer>
                                <MudContainer Class="d-flex align-center px-0 gap-2">
                                    <MudIcon Icon="@Icons.Material.Filled.Security" Color="Color.Primary" />
                                    <MudText Typo="Typo.body2">Never share passwords or sensitive account details in any survey response.</MudText>
                                </MudContainer>
                            </MudList>

                            <MudStack Direction="Row" Spacing="2" AlignItems="AlignItems.Center" Class="flex-wrap">
                                <MudCheckBox T="bool"
                                             @bind-Value="HasAcknowledgedGuidelines"
                                             Disabled="@HasStartedSurvey"
                                             Label="I understand these guidelines." />
                                <MudButton Variant="Variant.Filled"
                                           Color="Color.Primary"
                                           Disabled="@(!CanContinue)"
                                           OnClick="ContinueToSurvey">
                                    Continue to Survey
                                </MudButton>
                            </MudStack>
                        </MudStack>
                    </MudStack>
                </MudPaper>
            }
            else
            {
                <MudStack Spacing="3">
                    <div id="surveyContainer" class="survey-container"></div>
                </MudStack>
            }
        }
    </MudStack>
</MudContainer>
